# ä»£ç†æ± é…ç½®æŒ‡å—

## æ¦‚è¿°

æœ¬ç³»ç»Ÿæ”¯æŒå¢å¼ºç‰ˆä»£ç†æ± ï¼Œå¯åŒæ—¶ä½¿ç”¨ä»˜è´¹ä»£ç†å’Œå…è´¹ä»£ç†ï¼Œç¡®ä¿çˆ¬è™«çš„ç¨³å®šæ€§å’Œååçˆ¬èƒ½åŠ›ã€‚

## ç­–ç•¥è°ƒæ•´ âœ…

**é‡è¦å˜æ›´ï¼šç­–ç•¥1ç°åœ¨æ˜¯æ³•å¾‹æ³•è§„æ•°æ®åº“ï¼**

### æ–°çš„çˆ¬è™«ç­–ç•¥é¡ºåºï¼š
1. **ç­–ç•¥1: å›½å®¶æ³•å¾‹æ³•è§„æ•°æ®åº“** (flk.npc.gov.cn) - æƒå¨æ•°æ®æºï¼Œä¼˜å…ˆä½¿ç”¨
2. **ç­–ç•¥2: æœç´¢å¼•æ“çˆ¬è™«** - é€šè¿‡æœç´¢å¼•æ“å®šä½æ³•è§„ï¼Œè¡¥å……è¦†ç›–
3. **ç­–ç•¥3: Seleniumæ”¿åºœç½‘çˆ¬è™«** - æµè§ˆå™¨è‡ªåŠ¨åŒ–ï¼Œå¤„ç†å¤æ‚é¡µé¢
4. **ç­–ç•¥4: ç›´æ¥URLè®¿é—®çˆ¬è™«** - æœ€åä¿éšœç­–ç•¥

## ä»£ç†æ± é…ç½®

### 1. é…ç½®æ–‡ä»¶ç»“æ„

```
config/
â”œâ”€â”€ proxy_config.toml      # ä¸»ä»£ç†é…ç½®æ–‡ä»¶ âœ… å·²åˆ›å»º
â”œâ”€â”€ dev.toml              # å¼€å‘ç¯å¢ƒé…ç½® âœ… å·²æ›´æ–°
â””â”€â”€ settings.py           # é…ç½®ç®¡ç† âœ… å·²æ›´æ–°
```

### 2. ä»˜è´¹ä»£ç†é…ç½®

æ‚¨çš„æˆªå›¾æ˜¾ç¤ºçš„ä»£ç†ä¿¡æ¯å·²ç»é…ç½®åˆ° `config/proxy_config.toml`ï¼š

```toml
[[proxy_pool.paid_proxies.servers]]
name = "æ–°åŠ å¡ä»£ç†"
remarks = "æ–°åŠ å¡C|ä¸­è½¬|Trojan"
address = "best.cute-cloud.de"
port = 52203
password = "d32b360a-621a-472d-a29e-38f2ca977970"
protocol = "trojan"
tls = true
sni = "sgc.cloud-services.top"
allowInsecure = true
```

### 3. æ·»åŠ æ›´å¤šä»£ç†æœåŠ¡å™¨

å¦‚æœæ‚¨æœ‰å¤šä¸ªä»£ç†æœåŠ¡å™¨ï¼Œå¯ä»¥åœ¨é…ç½®æ–‡ä»¶ä¸­æ·»åŠ ï¼š

```toml
# æ·»åŠ ç¬¬äºŒä¸ªä»£ç†æœåŠ¡å™¨
[[proxy_pool.paid_proxies.servers]]
name = "ç¾å›½ä»£ç†"
address = "us-proxy.example.com"
port = 1080
username = "your_username"
password = "your_password"
protocol = "socks5"

# æ·»åŠ ç¬¬ä¸‰ä¸ªä»£ç†æœåŠ¡å™¨
[[proxy_pool.paid_proxies.servers]]
name = "æ—¥æœ¬ä»£ç†"
address = "jp-proxy.example.com"
port = 8080
protocol = "http"
```

### 4. ä»£ç†ç±»å‹æ”¯æŒ

æ”¯æŒå¤šç§ä»£ç†åè®®ï¼š
- **HTTP/HTTPS**: æ ‡å‡†HTTPä»£ç†
- **SOCKS4/SOCKS5**: Socketä»£ç†
- **Trojan**: æ‚¨å½“å‰ä½¿ç”¨çš„åè®® âœ…

### 5. ä»£ç†ä½¿ç”¨ç­–ç•¥

```toml
[proxy_pool.strategy]
mode = "rotation"                    # è½®æ¢æ¨¡å¼
retry_on_failure = true             # å¤±è´¥é‡è¯•
fallback_to_direct = false          # ä¸å›é€€åˆ°ç›´è¿
max_failures_before_disable = 5     # å¤±è´¥5æ¬¡åç¦ç”¨
```

## ä½¿ç”¨æ–¹æ³•

### 1. æµ‹è¯•ä»£ç†é…ç½®

```bash
python test_enhanced_proxy_pool.py
```

æµ‹è¯•ç»“æœç¤ºä¾‹ï¼š
```
âœ… é…ç½®åŠ è½½æˆåŠŸ: 1 ä¸ªä¸»è¦é…ç½®å—
âœ… è§£æåˆ°ä»˜è´¹ä»£ç†: 1 ä¸ª
âœ… ä»£ç†æ± åˆå§‹åŒ–æˆåŠŸ
âœ… ä»˜è´¹ä»£ç†: 1/1 (æˆåŠŸç‡: 100.0%)
âœ… è·å–ä»˜è´¹ä»£ç†æˆåŠŸ
```

### 2. åœ¨çˆ¬è™«ä¸­ä½¿ç”¨ä»£ç†

ä»£ç†æ± ä¼šè‡ªåŠ¨é›†æˆåˆ°çˆ¬è™«ç³»ç»Ÿä¸­ï¼š

```python
from src.crawler.utils.enhanced_proxy_pool import get_enhanced_proxy_pool

# è·å–ä»£ç†æ± å®ä¾‹
pool = await get_enhanced_proxy_pool()

# è·å–å¯ç”¨ä»£ç†
proxy = await pool.get_proxy(prefer_paid=True)

# åœ¨è¯·æ±‚ä¸­ä½¿ç”¨ä»£ç†
async with aiohttp.ClientSession() as session:
    async with session.get(url, proxy=proxy.proxy_url) as response:
        # å¤„ç†å“åº”
        pass
```

### 3. å¯åŠ¨å®Œæ•´çˆ¬è™«ç³»ç»Ÿ

```bash
python main.py
```

ç³»ç»Ÿä¼šè‡ªåŠ¨ï¼š
1. åŠ è½½ä»£ç†é…ç½®
2. éªŒè¯ä»£ç†å¯ç”¨æ€§
3. åœ¨çˆ¬å–è¿‡ç¨‹ä¸­æ™ºèƒ½è½®æ¢ä»£ç†

## ä»£ç†é…ç½®æœ€ä½³å®è·µ

### 1. å®‰å…¨é…ç½®
- âœ… å¯†ç ç­‰æ•æ„Ÿä¿¡æ¯å·²æ”¾åœ¨é…ç½®æ–‡ä»¶ä¸­
- ğŸ”’ å»ºè®®ä½¿ç”¨ç¯å¢ƒå˜é‡è¦†ç›–æ•æ„Ÿé…ç½®
- ğŸ“ ä¸è¦å°†é…ç½®æ–‡ä»¶æäº¤åˆ°å…¬å…±ä»£ç ä»“åº“

### 2. æ€§èƒ½ä¼˜åŒ–
- âœ… ä»˜è´¹ä»£ç†ä¼˜å…ˆçº§æ›´é«˜
- âœ… è‡ªåŠ¨å¥åº·æ£€æŸ¥å’Œæ•…éšœè½¬ç§»
- âœ… æ™ºèƒ½è½®æ¢å‡å°‘å•ç‚¹å‹åŠ›

### 3. ç›‘æ§å’Œç»´æŠ¤
```bash
# æŸ¥çœ‹ä»£ç†æ± çŠ¶æ€
python -c "
import asyncio
from src.crawler.utils.enhanced_proxy_pool import get_enhanced_proxy_pool

async def check_status():
    pool = await get_enhanced_proxy_pool()
    pool.print_stats()

asyncio.run(check_status())
"
```

## æ•…éšœæ’é™¤

### 1. ä»£ç†è¿æ¥å¤±è´¥
- æ£€æŸ¥ä»£ç†æœåŠ¡å™¨åœ°å€å’Œç«¯å£
- éªŒè¯è®¤è¯ä¿¡æ¯ï¼ˆç”¨æˆ·å/å¯†ç ï¼‰
- ç¡®è®¤ä»£ç†åè®®ç±»å‹æ­£ç¡®

### 2. é…ç½®åŠ è½½å¤±è´¥
- æ£€æŸ¥TOMLæ–‡ä»¶è¯­æ³•
- ç¡®è®¤æ–‡ä»¶è·¯å¾„æ­£ç¡®
- æŸ¥çœ‹æ—¥å¿—è·å–è¯¦ç»†é”™è¯¯ä¿¡æ¯

### 3. æ€§èƒ½é—®é¢˜
- è°ƒæ•´å¹¶å‘æ•°é‡
- å¢åŠ ä»£ç†æ£€æŸ¥é—´éš”
- ç›‘æ§ä»£ç†å“åº”æ—¶é—´

## é«˜çº§é…ç½®

### 1. ç‰¹å®šç½‘ç«™ä»£ç†ç­–ç•¥
```toml
[proxy_pool.site_specific]
"flk.npc.gov.cn" = { use_proxy = true, preferred_type = "paid" }
"*.gov.cn" = { use_proxy = true, preferred_type = "paid" }
"*.google.com" = { use_proxy = true, preferred_type = "paid" }
```

### 2. å…è´¹ä»£ç†æ”¯æŒ
```toml
[proxy_pool.free_proxies]
enabled = false  # å½“å‰å…³é—­ï¼Œå› ä¸ºæœ‰ä»˜è´¹ä»£ç†
sources = [
    "https://raw.githubusercontent.com/TheSpeedX/PROXY-List/master/http.txt"
]
```

## é…ç½®éªŒè¯ âœ…

æ ¹æ®æµ‹è¯•ç»“æœï¼Œå½“å‰é…ç½®å®Œå…¨æ­£å¸¸ï¼š

- âœ… ç­–ç•¥é¡ºåºå·²è°ƒæ•´ï¼šæ³•å¾‹æ³•è§„æ•°æ®åº“ä¼˜å…ˆ
- âœ… ä»£ç†é…ç½®æ–‡ä»¶åˆ›å»ºæˆåŠŸ
- âœ… ä»˜è´¹ä»£ç†è§£ææ­£ç¡®
- âœ… ä»£ç†æ± åˆå§‹åŒ–æˆåŠŸ
- âœ… ä»£ç†è·å–å’Œè½®æ¢æ­£å¸¸
- âœ… å¥åº·æ£€æŸ¥æœºåˆ¶å·¥ä½œæ­£å¸¸

æ‚¨çš„ä»£ç†æœåŠ¡å™¨ `best.cute-cloud.de:52203` å·²æˆåŠŸé…ç½®å¹¶å¯æ­£å¸¸ä½¿ç”¨ï¼

## ä¸‹ä¸€æ­¥

ç°åœ¨å¯ä»¥ï¼š
1. å¯åŠ¨å®Œæ•´çš„çˆ¬è™«ç³»ç»Ÿæµ‹è¯•
2. æ ¹æ®éœ€è¦æ·»åŠ æ›´å¤šä»£ç†æœåŠ¡å™¨
3. è°ƒæ•´ä»£ç†ä½¿ç”¨ç­–ç•¥å’Œå‚æ•°
4. ç›‘æ§ä»£ç†æ± è¿è¡ŒçŠ¶æ€ 